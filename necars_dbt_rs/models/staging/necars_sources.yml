version: 2

sources:
  - name: necars_source
    tags: [source]
    database: necars_db
    schema: source_schema
    tables:
      - name: vehicle_purchase
        columns:
          - name: full_stock_number
            data_tests:
              - unique
              - not_null
          - name: purchase_invoice_date
            data_tests:
              - not_null
          - name: nominal_purchase_code
            data_tests:
              - not_null
              - accepted_values:
                  arguments:
                    values: [5300]
          - name: make
            data_tests:
              - not_null
          - name: description
            data_tests:
              - not_null
          - name: supplier
            data_tests:
              - not_null
          - name: purchase_price_gbp
            data_tests:
              - not_null
              - test_non_negative_values
      - name: reconditioning_cost
        columns:
          - name: stock_number
            data_tests:
              - not_null
          - name: date
            data_tests:
              - not_null
          - name: description
            data_tests:
              - not_null
          - name: quantity
            data_tests:
              - not_null
              - test_positive_values
          - name: gross_amount
            data_tests:
              - not_null
          - name: vat
            data_tests:
              - not_null
              - test_non_negative_values
          - name: net_cost_price
            data_tests:
              - not_null
              - test_non_negative_values
          - name: net_extra_price
            data_tests:
              - not_null
              - test_non_negative_values
          - name: nominal_code
            data_tests:
              - not_null
              - accepted_values:
                  arguments:
                    values: [5210, 5301, 5302, 5303, 5304, 5305, 5405, 5350, 6001, 6002, 6500]
          - name: supplier
            data_tests:
              - not_null
          - name: sage_ref
            data_tests:
              - unique
              - not_null
        #       - relationships:
        #           to: source('necars_source', 'vehicle_purchase')
        #           field: "SUBSTRING(full_stock_number, 2)"
